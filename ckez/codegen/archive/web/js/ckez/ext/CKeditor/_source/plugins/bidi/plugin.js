(function(){var p={table:1,ul:1,ol:1,blockquote:1,div:1},d={},n={};CKEDITOR.tools.extend(d,p,{tr:1,p:1,div:1,li:1});CKEDITOR.tools.extend(n,d,{td:1});function l(i){g(i);m(i)}function g(q){var r=q.editor,s=q.data.path;if(r.readOnly){return}var i=r.config.useComputedState,t;i=i===undefined||i;if(!i){t=k(s.lastElement)}t=t||s.block||s.blockLimit;t.is("body")&&(t=r.getSelection().getRanges()[0].getEnclosedNode());if(!t){return}var u=i?t.getComputedStyle("direction"):t.getStyle("direction")||t.getAttribute("dir");r.getCommand("bidirtl").setState(u=="rtl"?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF);r.getCommand("bidiltr").setState(u=="ltr"?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)}function m(i){var q=i.editor,r=i.data.path.block||i.data.path.blockLimit;q.fire("contentDirChanged",r?r.getComputedStyle("direction"):q.lang.dir)}function k(q){while(q&&!(q.getName() in n||q.is("body"))){var i=q.getParent();if(!i){break}q=i}return q}function j(r,q,t,v){if(r.isReadOnly()){return}CKEDITOR.dom.element.setMarker(v,r,"bidi_processed",1);var s=r;while((s=s.getParent())&&!s.is("body")){if(s.getCustomData("bidi_processed")){r.removeStyle("direction");r.removeAttribute("dir");return}}var i=("useComputedState" in t.config)?t.config.useComputedState:1;var u=i?r.getComputedStyle("direction"):r.getStyle("direction")||r.hasAttribute("dir");if(u==q){return}r.removeStyle("direction");if(i){r.removeAttribute("dir");if(q!=r.getComputedStyle("direction")){r.setAttribute("dir",q)}}else{r.setAttribute("dir",q)}t.forceNextSelectionCheck();return}function a(i,t,s){var q=i.getCommonAncestor(false,true);i=i.clone();i.enlarge(s==CKEDITOR.ENTER_BR?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS);if(i.checkBoundaryOfElement(q,CKEDITOR.START)&&i.checkBoundaryOfElement(q,CKEDITOR.END)){var r;while(q&&q.type==CKEDITOR.NODE_ELEMENT&&(r=q.getParent())&&r.getChildCount()==1&&!(q.getName() in t)){q=r}return q.type==CKEDITOR.NODE_ELEMENT&&(q.getName() in t)&&q}}function o(i){return function(A){var C=A.getSelection(),B=A.config.enterMode,r=C.getRanges();if(r&&r.length){var E={};var t=C.createBookmarks();var D=r.createIterator(),z,w=0;while((z=D.getNextRange(1))){var y=z.getEnclosedNode();if(!y||y&&!(y.type==CKEDITOR.NODE_ELEMENT&&y.getName() in d)){y=a(z,p,B)}y&&j(y,i,A,E);var x,v;var q=new CKEDITOR.dom.walker(z);var s=t[w].startNode,u=t[w++].endNode;q.evaluator=function(F){return !!(F.type==CKEDITOR.NODE_ELEMENT&&F.getName() in p&&!(F.getName()==(B==CKEDITOR.ENTER_P?"p":"div")&&F.getParent().type==CKEDITOR.NODE_ELEMENT&&F.getParent().getName()=="blockquote")&&F.getPosition(s)&CKEDITOR.POSITION_FOLLOWING&&((F.getPosition(u)&CKEDITOR.POSITION_PRECEDING+CKEDITOR.POSITION_CONTAINS)==CKEDITOR.POSITION_PRECEDING))};while((v=q.next())){j(v,i,A,E)}x=z.createIterator();x.enlargeBr=B!=CKEDITOR.ENTER_BR;while((v=x.getNextParagraph(B==CKEDITOR.ENTER_P?"p":"div"))){j(v,i,A,E)}}CKEDITOR.dom.element.clearAllMarkers(E);A.forceNextSelectionCheck();C.selectBookmarks(t);A.focus()}}}CKEDITOR.plugins.add("bidi",{requires:["styles","button"],init:function(i){var q=function(s,v,u,t){i.addCommand(u,new CKEDITOR.command(i,{exec:t}));i.ui.addButton(s,{label:v,command:u})};var r=i.lang.bidi;q("BidiLtr",r.ltr,"bidiltr",o("ltr"));q("BidiRtl",r.rtl,"bidirtl",o("rtl"));i.on("selectionChange",l);i.on("contentDom",function(){i.document.on("dirChanged",function(s){i.fire("dirChanged",{node:s.data,dir:s.data.getDirection(1)})})})}});function c(q){var i=q.getDocument().getBody().getParent();while(q){if(q.equals(i)){return false}q=q.getParent()}return true}function f(s){var r=s==b.setAttribute,q=s==b.removeAttribute,i=/\bdirection\s*:\s*(.*?)\s*(:?$|;)/;return function(v,w){if(!this.getDocument().equals(CKEDITOR.document)){var u;if((v==(r||q?"dir":"direction")||v=="style"&&(q||i.test(w)))&&!c(this)){u=this.getDirection(1);var t=s.apply(this,arguments);if(u!=this.getDirection(1)){this.getDocument().fire("dirChanged",this);return t}}}return s.apply(this,arguments)}}var b=CKEDITOR.dom.element.prototype,e=["setStyle","removeStyle","setAttribute","removeAttribute"];for(var h=0;h<e.length;h++){b[e[h]]=CKEDITOR.tools.override(b[e[h]],f)}})();