CKEDITOR.plugins.add("dialogui");(function(){var g=function(l){this._||(this._={});this._["default"]=this._.initValue=l["default"]||"";this._.required=l.required||false;var j=[this._];for(var k=1;k<arguments.length;k++){j.push(arguments[k])}j.push(true);CKEDITOR.tools.extend.apply(CKEDITOR.tools,j);return this._},a={build:function(j,k,i){return new CKEDITOR.ui.dialog.textInput(j,k,i)}},d={build:function(j,k,i){return new CKEDITOR.ui.dialog[k.type](j,k,i)}},f={build:function(p,j,m){var l=j.children,k,r=[],q=[];for(var o=0;(o<l.length&&(k=l[o]));o++){var n=[];r.push(n);q.push(CKEDITOR.dialog._.uiElementBuilders[k.type].build(p,k,n))}return new CKEDITOR.ui.dialog[j.type](p,q,r,m,j)}},c={isChanged:function(){return this.getValue()!=this.getInitValue()},reset:function(i){this.setValue(this.getInitValue(),i)},setInitValue:function(){this._.initValue=this.getValue()},resetInitValue:function(){this._.initValue=this._["default"]},getInitValue:function(){return this._.initValue}},b=CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onChange:function(i,j){if(!this._.domOnChangeRegistered){i.on("load",function(){this.getInputElement().on("change",function(){if(!i.parts.dialog.isVisible()){return}this.fire("change",{value:this.getValue()})},this)},this);this._.domOnChangeRegistered=true}this.on("change",j)}},true),h=/^on([A-Z]\w+)/,e=function(k){for(var j in k){if(h.test(j)||j=="title"||j=="type"){delete k[j]}}return k};CKEDITOR.tools.extend(CKEDITOR.ui.dialog,{labeledElement:function(k,o,l,m){if(arguments.length<4){return}var i=g.call(this,o);i.labelId=CKEDITOR.tools.getNextId()+"_label";var j=this._.children=[];var n=function(){var r=[],p=o.required?" cke_required":"";if(o.labelLayout!="horizontal"){r.push('<label class="cke_dialog_ui_labeled_label'+p+'" ',' id="'+i.labelId+'"',' for="'+i.inputId+'"',' style="'+o.labelStyle+'">',o.label,"</label>",'<div class="cke_dialog_ui_labeled_content" role="presentation">',m.call(this,k,o),"</div>")}else{var q={type:"hbox",widths:o.widths,padding:0,children:[{type:"html",html:'<label class="cke_dialog_ui_labeled_label'+p+'" id="'+i.labelId+'" for="'+i.inputId+'" style="'+o.labelStyle+'">'+CKEDITOR.tools.htmlEncode(o.label)+"</span>"},{type:"html",html:'<span class="cke_dialog_ui_labeled_content">'+m.call(this,k,o)+"</span>"}]};CKEDITOR.dialog._.uiElementBuilders.hbox.build(k,q,r)}return r.join("")};CKEDITOR.ui.dialog.uiElement.call(this,k,o,l,"div",null,{role:"presentation"},n)},textInput:function(o,j,k){if(arguments.length<3){return}g.call(this,j);var l=this._.inputId=CKEDITOR.tools.getNextId()+"_textInput",m={"class":"cke_dialog_ui_input_"+j.type,id:l,type:"text"},n;if(j.validate){this.validate=j.validate}if(j.maxLength){m.maxlength=j.maxLength}if(j.size){m.size=j.size}if(j.controlStyle){m.style=j.controlStyle}var p=this,r=false;o.on("load",function(){p.getInputElement().on("keydown",function(i){if(i.data.getKeystroke()==13){r=true}});p.getInputElement().on("keyup",function(i){if(i.data.getKeystroke()==13&&r){o.getButton("ok")&&setTimeout(function(){o.getButton("ok").click()},0);r=false}},null,null,1000)});var q=function(){var t=['<div class="cke_dialog_ui_input_',j.type,'" role="presentation"'];if(j.width){t.push('style="width:'+j.width+'" ')}t.push("><input ");m["aria-labelledby"]=this._.labelId;this._.required&&(m["aria-required"]=this._.required);for(var s in m){t.push(s+'="'+m[s]+'" ')}t.push(" /></div>");return t.join("")};CKEDITOR.ui.dialog.labeledElement.call(this,o,j,k,q)},textarea:function(j,o,m){if(arguments.length<3){return}g.call(this,o);var k=this,l=this._.inputId=CKEDITOR.tools.getNextId()+"_textarea",i={};if(o.validate){this.validate=o.validate}i.rows=o.rows||5;i.cols=o.cols||20;var n=function(){i["aria-labelledby"]=this._.labelId;this._.required&&(i["aria-required"]=this._.required);var q=['<div class="cke_dialog_ui_input_textarea" role="presentation"><textarea class="cke_dialog_ui_input_textarea" id="',l,'" '];for(var p in i){q.push(p+'="'+CKEDITOR.tools.htmlEncode(i[p])+'" ')}q.push(">",CKEDITOR.tools.htmlEncode(k._["default"]),"</textarea></div>");return q.join("")};CKEDITOR.ui.dialog.labeledElement.call(this,j,o,m,n)},checkbox:function(j,m,k){if(arguments.length<3){return}var i=g.call(this,m,{"default":!!m["default"]});if(m.validate){this.validate=m.validate}var l=function(){var p=CKEDITOR.tools.extend({},m,{id:m.id?m.id+"_checkbox":CKEDITOR.tools.getNextId()+"_checkbox"},true),o=[];var q=CKEDITOR.tools.getNextId()+"_label";var n={"class":"cke_dialog_ui_checkbox_input",type:"checkbox","aria-labelledby":q};e(p);if(m["default"]){n.checked="checked"}if(typeof p.controlStyle!="undefined"){p.style=p.controlStyle}i.checkbox=new CKEDITOR.ui.dialog.uiElement(j,p,o,"input",null,n);o.push(' <label id="',q,'" for="',n.id,'">',CKEDITOR.tools.htmlEncode(m.label),"</label>");return o.join("")};CKEDITOR.ui.dialog.uiElement.call(this,j,m,k,"span",null,null,l)},radio:function(j,n,l){if(arguments.length<3){return}g.call(this,n);if(!this._["default"]){this._["default"]=this._.initValue=n.items[0][1]}if(n.validate){this.validate=n.valdiate}var i=[],k=this;var m=function(){var z=[],s=[],y={"class":"cke_dialog_ui_radio_item","aria-labelledby":this._.labelId},q=n.id?n.id+"_radio":CKEDITOR.tools.getNextId()+"_radio";for(var r=0;r<n.items.length;r++){var A=n.items[r],v=A[2]!==undefined?A[2]:A[0],x=A[1]!==undefined?A[1]:A[0],w=CKEDITOR.tools.getNextId()+"_radio_input",p=w+"_label",t=CKEDITOR.tools.extend({},n,{id:w,title:null,type:null},true),o=CKEDITOR.tools.extend({},t,{title:v},true),u={type:"radio","class":"cke_dialog_ui_radio_input",name:q,value:x,"aria-labelledby":p},B=[];if(k._["default"]==x){u.checked="checked"}e(t);e(o);if(typeof t.controlStyle!="undefined"){t.style=t.controlStyle}i.push(new CKEDITOR.ui.dialog.uiElement(j,t,B,"input",null,u));B.push(" ");new CKEDITOR.ui.dialog.uiElement(j,o,B,"label",null,{id:p,"for":u.id},A[0]);z.push(B.join(""))}new CKEDITOR.ui.dialog.hbox(j,[],z,s);return s.join("")};CKEDITOR.ui.dialog.labeledElement.call(this,j,n,l,m);this._.children=i},button:function(i,n,l){if(!arguments.length){return}if(typeof n=="function"){n=n(i.getParentEditor())}g.call(this,n,{disabled:n.disabled||false});CKEDITOR.event.implementOn(this);var j=this;i.on("load",function(p){var o=this.getElement();(function(){o.on("click",function(q){j.fire("click",{dialog:j.getDialog()});q.data.preventDefault()});o.on("keydown",function(q){if(q.data.getKeystroke() in {32:1}){j.click();q.data.preventDefault()}})})();o.unselectable()},this);var m=CKEDITOR.tools.extend({},n);delete m.style;var k=CKEDITOR.tools.getNextId()+"_label";CKEDITOR.ui.dialog.uiElement.call(this,i,m,l,"a",null,{style:n.style,href:"javascript:void(0)",title:n.label,hidefocus:"true","class":n["class"],role:"button","aria-labelledby":k},'<span id="'+k+'" class="cke_dialog_ui_button">'+CKEDITOR.tools.htmlEncode(n.label)+"</span>")},select:function(j,m,k){if(arguments.length<3){return}var i=g.call(this,m);if(m.validate){this.validate=m.validate}i.inputId=CKEDITOR.tools.getNextId()+"_select";var l=function(){var q=CKEDITOR.tools.extend({},m,{id:m.id?m.id+"_select":CKEDITOR.tools.getNextId()+"_select"},true),p=[],s=[],n={id:i.inputId,"class":"cke_dialog_ui_input_select","aria-labelledby":this._.labelId};if(m.size!=undefined){n.size=m.size}if(m.multiple!=undefined){n.multiple=m.multiple}e(q);for(var o=0,r;o<m.items.length&&(r=m.items[o]);o++){s.push('<option value="',CKEDITOR.tools.htmlEncode(r[1]!==undefined?r[1]:r[0]).replace(/"/g,"&quot;"),'" /> ',CKEDITOR.tools.htmlEncode(r[0]))}if(typeof q.controlStyle!="undefined"){q.style=q.controlStyle}i.select=new CKEDITOR.ui.dialog.uiElement(j,q,p,"select",null,n,s.join(""));return p.join("")};CKEDITOR.ui.dialog.labeledElement.call(this,j,m,k,l)},file:function(j,m,k){if(arguments.length<3){return}if(m["default"]===undefined){m["default"]=""}var i=CKEDITOR.tools.extend(g.call(this,m),{definition:m,buttons:[]});if(m.validate){this.validate=m.validate}var l=function(){i.frameId=CKEDITOR.tools.getNextId()+"_fileInput";var n=CKEDITOR.env.isCustomDomain();var o=['<iframe frameborder="0" allowtransparency="0" class="cke_dialog_ui_input_file" id="',i.frameId,'" title="',m.label,'" src="javascript:void('];o.push(n?"(function(){document.open();document.domain='"+document.domain+"';document.close();})()":"0");o.push(')"></iframe>');return o.join("")};j.on("load",function(){var o=CKEDITOR.document.getById(i.frameId),n=o.getParent();n.addClass("cke_dialog_ui_input_file")});CKEDITOR.ui.dialog.labeledElement.call(this,j,m,k,l)},fileButton:function(k,o,m){if(arguments.length<3){return}var i=g.call(this,o),l=this;if(o.validate){this.validate=o.validate}var j=CKEDITOR.tools.extend({},o);var n=j.onClick;j.className=(j.className?j.className+" ":"")+"cke_dialog_ui_button";j.onClick=function(p){var q=o["for"];if(!n||n.call(this,p)!==false){k.getContentElement(q[0],q[1]).submit();this.disable()}};k.on("load",function(){k.getContentElement(o["for"][0],o["for"][1])._.buttons.push(l)});CKEDITOR.ui.dialog.button.call(this,k,j,m)},html:(function(){var k=/^\s*<[\w:]+\s+([^>]*)?>/,j=/^(\s*<[\w:]+(?:\s+[^>]*)?)((?:.|\r|\n)+)$/,i=/\/$/;return function(s,l,m){if(arguments.length<3){return}var o=[],u,p=l.html,q,t;if(p.charAt(0)!="<"){p="<span>"+p+"</span>"}var v=l.focus;if(v){var n=this.focus;this.focus=function(){n.call(this);typeof v=="function"&&v.call(this);this.fire("focus")};if(l.isFocusable){var r=this.isFocusable;this.isFocusable=r}this.keyboardFocusable=true}CKEDITOR.ui.dialog.uiElement.call(this,s,l,o,"span",null,null,"");u=o.join("");q=u.match(k);t=p.match(j)||["","",""];if(i.test(t[1])){t[1]=t[1].slice(0,-1);t[2]="/"+t[2]}m.push([t[1]," ",q[1]||"",t[2]].join(""))}})(),fieldset:function(i,o,n,k,m){var j=m.label;var l=function(){var q=[];j&&q.push("<legend>"+j+"</legend>");for(var p=0;p<n.length;p++){q.push(n[p])}return q.join("")};this._={children:o};CKEDITOR.ui.dialog.uiElement.call(this,i,m,k,"fieldset",null,null,l)}},true);CKEDITOR.ui.dialog.html.prototype=new CKEDITOR.ui.dialog.uiElement;CKEDITOR.ui.dialog.labeledElement.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setLabel:function(i){var j=CKEDITOR.document.getById(this._.labelId);if(j.getChildCount()<1){(new CKEDITOR.dom.text(i,CKEDITOR.document)).appendTo(j)}else{j.getChild(0).$.nodeValue=i}return this},getLabel:function(){var i=CKEDITOR.document.getById(this._.labelId);if(!i||i.getChildCount()<1){return""}else{return i.getChild(0).getText()}},eventProcessors:b},true);CKEDITOR.ui.dialog.button.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{click:function(){if(!this._.disabled){return this.fire("click",{dialog:this._.dialog})}this.getElement().$.blur();return false},enable:function(){this._.disabled=false;var i=this.getElement();i&&i.removeClass("cke_disabled")},disable:function(){this._.disabled=true;this.getElement().addClass("cke_disabled")},isVisible:function(){return this.getElement().getFirst().isVisible()},isEnabled:function(){return !this._.disabled},eventProcessors:CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onClick:function(i,j){this.on("click",j)}},true),accessKeyUp:function(){this.click()},accessKeyDown:function(){this.focus()},keyboardFocusable:true},true);CKEDITOR.ui.dialog.textInput.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return CKEDITOR.document.getById(this._.inputId)},focus:function(){var i=this.selectParentTab();setTimeout(function(){var j=i.getInputElement();j&&j.$.focus()},0)},select:function(){var i=this.selectParentTab();setTimeout(function(){var j=i.getInputElement();if(j){j.$.focus();j.$.select()}},0)},accessKeyUp:function(){this.select()},setValue:function(i){!i&&(i="");return CKEDITOR.ui.dialog.uiElement.prototype.setValue.apply(this,arguments)},keyboardFocusable:true},c,true);CKEDITOR.ui.dialog.textarea.prototype=new CKEDITOR.ui.dialog.textInput();CKEDITOR.ui.dialog.select.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return this._.select.getElement()},add:function(k,m,j){var l=new CKEDITOR.dom.element("option",this.getDialog().getParentEditor().document),i=this.getInputElement().$;l.$.text=k;l.$.value=(m===undefined||m===null)?k:m;if(j===undefined||j===null){if(CKEDITOR.env.ie){i.add(l.$)}else{i.add(l.$,null)}}else{i.add(l.$,j)}return this},remove:function(j){var i=this.getInputElement().$;i.remove(j);return this},clear:function(){var i=this.getInputElement().$;while(i.length>0){i.remove(0)}return this},keyboardFocusable:true},c,true);CKEDITOR.ui.dialog.checkbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getInputElement:function(){return this._.checkbox.getElement()},setValue:function(j,i){this.getInputElement().$.checked=j;!i&&this.fire("change",{value:j})},getValue:function(){return this.getInputElement().$.checked},accessKeyUp:function(){this.setValue(!this.getValue())},eventProcessors:{onChange:function(i,j){if(!CKEDITOR.env.ie){return b.onChange.apply(this,arguments)}else{i.on("load",function(){var k=this._.checkbox.getElement();k.on("propertychange",function(l){l=l.data.$;if(l.propertyName=="checked"){this.fire("change",{value:k.$.checked})}},this)},this);this.on("change",j)}return null}},keyboardFocusable:true},c,true);CKEDITOR.ui.dialog.radio.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setValue:function(n,m){var k=this._.children,l;for(var j=0;(j<k.length)&&(l=k[j]);j++){l.getElement().$.checked=(l.getValue()==n)}!m&&this.fire("change",{value:n})},getValue:function(){var k=this._.children;for(var j=0;j<k.length;j++){if(k[j].getElement().$.checked){return k[j].getValue()}}return null},accessKeyUp:function(){var k=this._.children,j;for(j=0;j<k.length;j++){if(k[j].getElement().$.checked){k[j].getElement().focus();return}}k[0].getElement().focus()},eventProcessors:{onChange:function(i,j){if(!CKEDITOR.env.ie){return b.onChange.apply(this,arguments)}else{i.on("load",function(){var m=this._.children,n=this;for(var l=0;l<m.length;l++){var k=m[l].getElement();k.on("propertychange",function(o){o=o.data.$;if(o.propertyName=="checked"&&this.$.checked){n.fire("change",{value:this.getAttribute("value")})}})}},this);this.on("change",j)}return null}},keyboardFocusable:true},c,true);CKEDITOR.ui.dialog.file.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,c,{getInputElement:function(){var i=CKEDITOR.document.getById(this._.frameId).getFrameDocument();return i.$.forms.length>0?new CKEDITOR.dom.element(i.$.forms[0].elements[0]):this.getElement()},submit:function(){this.getInputElement().getParent().$.submit();return this},getAction:function(){return this.getInputElement().getParent().$.action},registerEvents:function(l){var m=/^on([A-Z]\w+)/,j;var n=function(o,p,i,q){o.on("formLoaded",function(){o.getInputElement().on(i,q,o)})};for(var k in l){if(!(j=k.match(m))){continue}if(this.eventProcessors[k]){this.eventProcessors[k].call(this,this._.dialog,l[k])}else{n(this,this._.dialog,j[1].toLowerCase(),l[k])}}return this},reset:function(){var r=this._,n=CKEDITOR.document.getById(r.frameId),p=n.getFrameDocument(),i=r.definition,q=r.buttons,l=this.formLoadedNumber,m=this.formUnloadNumber,j=r.dialog._.editor.lang.dir,o=r.dialog._.editor.langCode;if(!l){l=this.formLoadedNumber=CKEDITOR.tools.addFunction(function(){this.fire("formLoaded")},this);m=this.formUnloadNumber=CKEDITOR.tools.addFunction(function(){this.getInputElement().clearCustomData()},this);this.getDialog()._.editor.on("destroy",function(){CKEDITOR.tools.removeFunction(l);CKEDITOR.tools.removeFunction(m)})}function k(){p.$.open();if(CKEDITOR.env.isCustomDomain()){p.$.domain=document.domain}var t="";if(i.size){t=i.size-(CKEDITOR.env.ie?7:0)}p.$.write(['<html dir="'+j+'" lang="'+o+'"><head><title></title></head><body style="margin: 0; overflow: hidden; background: transparent;">','<form enctype="multipart/form-data" method="POST" dir="'+j+'" lang="'+o+'" action="',CKEDITOR.tools.htmlEncode(i.action),'">','<input type="file" name="',CKEDITOR.tools.htmlEncode(i.id||"cke_upload"),'" size="',CKEDITOR.tools.htmlEncode(t>0?t:""),'" />',"</form>","</body></html>","<script>window.parent.CKEDITOR.tools.callFunction("+l+");","window.onbeforeunload = function() {window.parent.CKEDITOR.tools.callFunction("+m+")}<\/script>"].join(""));p.$.close();for(var s=0;s<q.length;s++){q[s].enable()}}if(CKEDITOR.env.gecko){setTimeout(k,500)}else{k()}},getValue:function(){return this.getInputElement().$.value||""},setInitValue:function(){this._.initValue=""},eventProcessors:{onChange:function(i,j){if(!this._.domOnChangeRegistered){this.on("formLoaded",function(){this.getInputElement().on("change",function(){this.fire("change",{value:this.getValue()})},this)},this);this._.domOnChangeRegistered=true}this.on("change",j)}},keyboardFocusable:true},true);CKEDITOR.ui.dialog.fileButton.prototype=new CKEDITOR.ui.dialog.button;CKEDITOR.ui.dialog.fieldset.prototype=CKEDITOR.tools.clone(CKEDITOR.ui.dialog.hbox.prototype);CKEDITOR.dialog.addUIElement("text",a);CKEDITOR.dialog.addUIElement("password",a);CKEDITOR.dialog.addUIElement("textarea",d);CKEDITOR.dialog.addUIElement("checkbox",d);CKEDITOR.dialog.addUIElement("radio",d);CKEDITOR.dialog.addUIElement("button",d);CKEDITOR.dialog.addUIElement("select",d);CKEDITOR.dialog.addUIElement("file",d);CKEDITOR.dialog.addUIElement("fileButton",d);CKEDITOR.dialog.addUIElement("html",d);CKEDITOR.dialog.addUIElement("fieldset",f)})();