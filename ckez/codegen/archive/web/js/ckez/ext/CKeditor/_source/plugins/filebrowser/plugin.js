(function(){function c(j,l){var m=[];if(!l){return j}else{for(var k in l){m.push(k+"="+encodeURIComponent(l[k]))}}return j+((j.indexOf("?")!=-1)?"&":"?")+m.join("&")}function a(k){k+="";var j=k.charAt(0).toUpperCase();return j+k.substr(1)}function f(k){var m=this.getDialog();var o=m.getParentEditor();o._.filebrowserSe=this;var n=o.config["filebrowser"+a(m.getName())+"WindowWidth"]||o.config.filebrowserWindowWidth||"80%";var j=o.config["filebrowser"+a(m.getName())+"WindowHeight"]||o.config.filebrowserWindowHeight||"70%";var p=this.filebrowser.params||{};p.CKEditor=o.name;p.CKEditorFuncNum=o._.filebrowserFn;if(!p.langCode){p.langCode=o.langCode}var l=c(this.filebrowser.url,p);o.popup(l,n,j,o.config.fileBrowserWindowFeatures)}function i(j){var k=this.getDialog();var l=k.getParentEditor();l._.filebrowserSe=this;if(!k.getContentElement(this["for"][0],this["for"][1]).getInputElement().$.value){return false}if(!k.getContentElement(this["for"][0],this["for"][1]).getAction()){return false}return true}function g(j,k,l){var m=l.params||{};m.CKEditor=j.name;m.CKEditorFuncNum=j._.filebrowserFn;if(!m.langCode){m.langCode=j.langCode}k.action=c(l.url,m);k.filebrowser=l}function d(r,m,l,j){var p,o;for(var q in j){p=j[q];if(p.type=="hbox"||p.type=="vbox"){d(r,m,l,p.children)}if(!p.filebrowser){continue}if(typeof p.filebrowser=="string"){var n={action:(p.type=="fileButton")?"QuickUpload":"Browse",target:p.filebrowser};p.filebrowser=n}if(p.filebrowser.action=="Browse"){var k=p.filebrowser.url;if(k===undefined){k=r.config["filebrowser"+a(m)+"BrowseUrl"];if(k===undefined){k=r.config.filebrowserBrowseUrl}}if(k){p.onClick=f;p.filebrowser.url=k;p.hidden=false}}else{if(p.filebrowser.action=="QuickUpload"&&p["for"]){k=p.filebrowser.url;if(k===undefined){k=r.config["filebrowser"+a(m)+"UploadUrl"];if(k===undefined){k=r.config.filebrowserUploadUrl}}if(k){var s=p.onClick;p.onClick=function(t){var u=t.sender;if(s&&s.call(u,t)===false){return false}return i.call(u,t)};p.filebrowser.url=k;p.hidden=false;g(r,l.getContents(p["for"][0]).get(p["for"][1]),p.filebrowser)}}}}}function h(l,k){var n=k.getDialog();var j=k.filebrowser.target||null;l=l.replace(/#/g,"%23");if(j){var o=j.split(":");var m=n.getContentElement(o[0],o[1]);if(m){m.setValue(l);n.selectPage(o[0])}}}function b(m,k,j){if(j.indexOf(";")!==-1){var n=j.split(";");for(var l=0;l<n.length;l++){if(b(m,k,n[l])){return true}}return false}var o=m.getContents(k).get(j).filebrowser;return(o&&o.url)}function e(k,n){var m=this._.filebrowserSe.getDialog(),j=this._.filebrowserSe["for"],l=this._.filebrowserSe.filebrowser.onSelect;if(j){m.getContentElement(j[0],j[1]).reset()}if(typeof n=="function"&&n.call(this._.filebrowserSe)===false){return}if(l&&l.call(this._.filebrowserSe,k,n)===false){return}if(typeof n=="string"&&n){alert(n)}if(k){h(k,this._.filebrowserSe)}}CKEDITOR.plugins.add("filebrowser",{init:function(k,j){k._.filebrowserFn=CKEDITOR.tools.addFunction(e,k);k.on("destroy",function(){CKEDITOR.tools.removeFunction(this._.filebrowserFn)})}});CKEDITOR.on("dialogDefinition",function(j){var m=j.data.definition,l;for(var k in m.contents){if((l=m.contents[k])){d(j.editor,j.data.name,m,l.elements);if(l.hidden&&l.filebrowser){l.hidden=!b(m,l.id,l.filebrowser)}}}})})();