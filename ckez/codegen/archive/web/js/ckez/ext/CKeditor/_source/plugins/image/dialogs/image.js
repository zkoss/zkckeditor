(function(){var a=function(f,i){var e=1,m=2,n=4,B=8,q=/^\s*(\d+)((px)|\%)?\s*$/i,A=/(^\s*(\d+)((px)|\%)?\s*$)|^$/i,l=/^\d+px$/;var y=function(){var E=this.getValue(),D=this.getDialog(),C=E.match(q);if(C){if(C[2]=="%"){v(D,false)}E=C[1]}if(D.lockRatio){var F=D.originalElement;if(F.getCustomData("isReady")=="true"){if(this.id=="txtHeight"){if(E&&E!="0"){E=Math.round(F.$.width*(E/F.$.height))}if(!isNaN(E)){D.setValueOf("info","txtWidth",E)}}else{if(E&&E!="0"){E=Math.round(F.$.height*(E/F.$.width))}if(!isNaN(E)){D.setValueOf("info","txtHeight",E)}}}}s(D)};var s=function(C){if(!C.originalElement||!C.preview){return 1}C.commitContent(n,C.preview);return 0};function u(){var D=arguments;var C=this.getContentElement("advanced","txtdlgGenStyle");C&&C.commit.apply(C,D);this.foreach(function(E){if(E.commit&&E.id!="txtdlgGenStyle"){E.commit.apply(E,D)}})}var o;function z(C){if(o){return}o=1;var F=this.getDialog(),E=F.imageElement;if(E){this.commit(e,E);C=[].concat(C);var G=C.length,H;for(var D=0;D<G;D++){H=F.getContentElement.apply(F,C[D].split(":"));H&&H.setup(e,E)}}o=0}var v=function(I,K){if(!I.getContentElement("info","ratioLock")){return null}var G=I.originalElement;if(!G){return null}if(K=="check"){if(!I.userlockRatio&&G.getCustomData("isReady")=="true"){var D=I.getValueOf("info","txtWidth"),L=I.getValueOf("info","txtHeight"),H=G.$.width*1000/G.$.height,C=D*1000/L;I.lockRatio=false;if(!D&&!L){I.lockRatio=true}else{if(!isNaN(H)&&!isNaN(C)){if(Math.round(H)==Math.round(C)){I.lockRatio=true}}}}}else{if(K!=undefined){I.lockRatio=K}else{I.userlockRatio=1;I.lockRatio=!I.lockRatio}}var F=CKEDITOR.document.getById(k);if(I.lockRatio){F.removeClass("cke_btn_unlocked")}else{F.addClass("cke_btn_unlocked")}var E=I._.editor.lang.image,J=E[I.lockRatio?"unlockRatio":"lockRatio"];F.setAttribute("title",J);F.getFirst().setText(J);return I.lockRatio};var j=function(C){var F=C.originalElement;if(F.getCustomData("isReady")=="true"){var E=C.getContentElement("info","txtWidth"),D=C.getContentElement("info","txtHeight");E&&E.setValue(F.$.width);D&&D.setValue(F.$.height)}s(C)};var p=function(F,E){if(F!=e){return}function I(L,J){var K=L.match(q);if(K){if(K[2]=="%"){K[1]+="%";v(D,false)}return K[1]}return J}var D=this.getDialog(),G="",H=this.id=="txtWidth"?"width":"height",C=E.getAttribute(H);if(C){G=I(C,G)}G=I(E.getStyle(H),G);this.setValue(G)};var c;var x=function(){var C=this.originalElement;C.setCustomData("isReady","true");C.removeListener("load",x);C.removeListener("error",h);C.removeListener("abort",h);CKEDITOR.document.getById(t).setStyle("display","none");if(!this.dontResetSize){j(this)}if(this.firstLoad){CKEDITOR.tools.setTimeout(function(){v(this,"check")},0,this)}this.firstLoad=false;this.dontResetSize=false};var h=function(){var D=this.originalElement;D.removeListener("load",x);D.removeListener("error",h);D.removeListener("abort",h);var C=CKEDITOR.getUrl(f.skinPath+"images/noimage.png");if(this.preview){this.preview.setAttribute("src",C)}CKEDITOR.document.getById(t).setStyle("display","none");v(this,false)};var w=function(C){return CKEDITOR.tools.getNextId()+"_"+C},k=w("btnLockSizes"),r=w("btnResetSize"),t=w("ImagePreviewLoader"),b=w("ImagePreviewBox"),d=w("previewLink"),g=w("previewImage");return{title:f.lang.image[i=="image"?"title":"titleButton"],minWidth:420,minHeight:360,onShow:function(){this.imageElement=false;this.linkElement=false;this.imageEditMode=false;this.linkEditMode=false;this.lockRatio=true;this.userlockRatio=0;this.dontResetSize=false;this.firstLoad=true;this.addLink=false;var F=this.getParentEditor(),H=this.getParentEditor().getSelection(),E=H.getSelectedElement(),G=E&&E.getAscendant("a");CKEDITOR.document.getById(t).setStyle("display","none");c=new CKEDITOR.dom.element("img",F.document);this.preview=CKEDITOR.document.getById(g);this.originalElement=F.document.createElement("img");this.originalElement.setAttribute("alt","");this.originalElement.setCustomData("isReady","false");if(G){this.linkElement=G;this.linkEditMode=true;var D=G.getChildren();if(D.count()==1){var C=D.getItem(0).getName();if(C=="img"||C=="input"){this.imageElement=D.getItem(0);if(this.imageElement.getName()=="img"){this.imageEditMode="img"}else{if(this.imageElement.getName()=="input"){this.imageEditMode="input"}}}}if(i=="image"){this.setupContent(m,G)}}if(E&&E.getName()=="img"&&!E.data("cke-realelement")||E&&E.getName()=="input"&&E.getAttribute("type")=="image"){this.imageEditMode=E.getName();this.imageElement=E}if(this.imageEditMode){this.cleanImageElement=this.imageElement;this.imageElement=this.cleanImageElement.clone(true,true);this.setupContent(e,this.imageElement)}else{this.imageElement=F.document.createElement("img")}v(this,true);if(!CKEDITOR.tools.trim(this.getValueOf("info","txtUrl"))){this.preview.removeAttribute("src");this.preview.setStyle("display","none")}},onOk:function(){if(this.imageEditMode){var C=this.imageEditMode;if(i=="image"&&C=="input"&&confirm(f.lang.image.button2Img)){C="img";this.imageElement=f.document.createElement("img");this.imageElement.setAttribute("alt","");f.insertElement(this.imageElement)}else{if(i!="image"&&C=="img"&&confirm(f.lang.image.img2Button)){C="input";this.imageElement=f.document.createElement("input");this.imageElement.setAttributes({type:"image",alt:""});f.insertElement(this.imageElement)}else{this.imageElement=this.cleanImageElement;delete this.cleanImageElement}}}else{if(i=="image"){this.imageElement=f.document.createElement("img")}else{this.imageElement=f.document.createElement("input");this.imageElement.setAttribute("type","image")}this.imageElement.setAttribute("alt","")}if(!this.linkEditMode){this.linkElement=f.document.createElement("a")}this.commitContent(e,this.imageElement);this.commitContent(m,this.linkElement);if(!this.imageElement.getAttribute("style")){this.imageElement.removeAttribute("style")}if(!this.imageEditMode){if(this.addLink){if(!this.linkEditMode){f.insertElement(this.linkElement);this.linkElement.append(this.imageElement,false)}else{f.insertElement(this.imageElement)}}else{f.insertElement(this.imageElement)}}else{if(!this.linkEditMode&&this.addLink){f.insertElement(this.linkElement);this.imageElement.appendTo(this.linkElement)}else{if(this.linkEditMode&&!this.addLink){f.getSelection().selectElement(this.linkElement);f.insertElement(this.imageElement)}}}},onLoad:function(){if(i!="image"){this.hidePage("Link")}var C=this._.element.getDocument();if(this.getContentElement("info","ratioLock")){this.addFocusable(C.getById(r),5);this.addFocusable(C.getById(k),5)}this.commitContent=u},onHide:function(){if(this.preview){this.commitContent(B,this.preview)}if(this.originalElement){this.originalElement.removeListener("load",x);this.originalElement.removeListener("error",h);this.originalElement.removeListener("abort",h);this.originalElement.remove();this.originalElement=false}delete this.imageElement},contents:[{id:"info",label:f.lang.image.infoTab,accessKey:"I",elements:[{type:"vbox",padding:0,children:[{type:"hbox",widths:["280px","110px"],align:"right",children:[{id:"txtUrl",type:"text",label:f.lang.common.url,required:true,onChange:function(){var E=this.getDialog(),F=this.getValue();if(F.length>0){E=this.getDialog();var D=E.originalElement;E.preview.removeStyle("display");D.setCustomData("isReady","false");var C=CKEDITOR.document.getById(t);if(C){C.setStyle("display","")}D.on("load",x,E);D.on("error",h,E);D.on("abort",h,E);D.setAttribute("src",F);c.setAttribute("src",F);E.preview.setAttribute("src",c.$.src);s(E)}else{if(E.preview){E.preview.removeAttribute("src");E.preview.setStyle("display","none")}}},setup:function(E,D){if(E==e){var C=D.data("cke-saved-src")||D.getAttribute("src");var F=this;this.getDialog().dontResetSize=true;F.setValue(C);F.setInitValue()}},commit:function(D,C){if(D==e&&(this.getValue()||this.isChanged())){C.data("cke-saved-src",this.getValue());C.setAttribute("src",this.getValue())}else{if(D==B){C.setAttribute("src","");C.removeAttribute("src")}}},validate:CKEDITOR.dialog.validate.notEmpty(f.lang.image.urlMissing)},{type:"button",id:"browse",style:"display:inline-block;margin-top:10px;",align:"center",label:f.lang.common.browseServer,hidden:true,filebrowser:"info:txtUrl"}]}]},{id:"txtAlt",type:"text",label:f.lang.image.alt,accessKey:"T","default":"",onChange:function(){s(this.getDialog())},setup:function(D,C){if(D==e){this.setValue(C.getAttribute("alt"))}},commit:function(D,C){if(D==e){if(this.getValue()||this.isChanged()){C.setAttribute("alt",this.getValue())}}else{if(D==n){C.setAttribute("alt",this.getValue())}else{if(D==B){C.removeAttribute("alt")}}}}},{type:"hbox",children:[{id:"basic",type:"vbox",children:[{type:"hbox",widths:["50%","50%"],children:[{type:"vbox",padding:1,children:[{type:"text",width:"40px",id:"txtWidth",label:f.lang.common.width,onKeyUp:y,onChange:function(){z.call(this,"advanced:txtdlgGenStyle")},validate:function(){var C=this.getValue().match(A),D=!!(C&&parseInt(C[1],10)!==0);if(!D){alert(f.lang.common.invalidWidth)}return D},setup:p,commit:function(F,E,D){var G=this.getValue();if(F==e){if(G){E.setStyle("width",CKEDITOR.tools.cssLength(G))}else{E.removeStyle("width")}!D&&E.removeAttribute("width")}else{if(F==n){var C=G.match(q);if(!C){var H=this.getDialog().originalElement;if(H.getCustomData("isReady")=="true"){E.setStyle("width",H.$.width+"px")}}else{E.setStyle("width",CKEDITOR.tools.cssLength(G))}}else{if(F==B){E.removeAttribute("width");E.removeStyle("width")}}}}},{type:"text",id:"txtHeight",width:"40px",label:f.lang.common.height,onKeyUp:y,onChange:function(){z.call(this,"advanced:txtdlgGenStyle")},validate:function(){var C=this.getValue().match(A),D=!!(C&&parseInt(C[1],10)!==0);if(!D){alert(f.lang.common.invalidHeight)}return D},setup:p,commit:function(F,E,D){var G=this.getValue();if(F==e){if(G){E.setStyle("height",CKEDITOR.tools.cssLength(G))}else{E.removeStyle("height")}!D&&E.removeAttribute("height")}else{if(F==n){var C=G.match(q);if(!C){var H=this.getDialog().originalElement;if(H.getCustomData("isReady")=="true"){E.setStyle("height",H.$.height+"px")}}else{E.setStyle("height",CKEDITOR.tools.cssLength(G))}}else{if(F==B){E.removeAttribute("height");E.removeStyle("height")}}}}}]},{id:"ratioLock",type:"html",style:"margin-top:30px;width:40px;height:40px;",onLoad:function(){var C=CKEDITOR.document.getById(r),D=CKEDITOR.document.getById(k);if(C){C.on("click",function(E){j(this);E.data&&E.data.preventDefault()},this.getDialog());C.on("mouseover",function(){this.addClass("cke_btn_over")},C);C.on("mouseout",function(){this.removeClass("cke_btn_over")},C)}if(D){D.on("click",function(F){var G=v(this),I=this.originalElement,H=this.getValueOf("info","txtWidth");if(I.getCustomData("isReady")=="true"&&H){var E=I.$.height/I.$.width*H;if(!isNaN(E)){this.setValueOf("info","txtHeight",Math.round(E));s(this)}}F.data.preventDefault()},this.getDialog());D.on("mouseover",function(){this.addClass("cke_btn_over")},D);D.on("mouseout",function(){this.removeClass("cke_btn_over")},D)}},html:'<div><a href="javascript:void(0)" tabindex="-1" title="'+f.lang.image.unlockRatio+'" class="cke_btn_locked" id="'+k+'" role="button"><span class="cke_label">'+f.lang.image.unlockRatio+'</span></a><a href="javascript:void(0)" tabindex="-1" title="'+f.lang.image.resetSize+'" class="cke_btn_reset" id="'+r+'" role="button"><span class="cke_label">'+f.lang.image.resetSize+"</span></a></div>"}]},{type:"vbox",padding:1,children:[{type:"text",id:"txtBorder",width:"60px",label:f.lang.image.border,"default":"",onKeyUp:function(){s(this.getDialog())},onChange:function(){z.call(this,"advanced:txtdlgGenStyle")},validate:CKEDITOR.dialog.validate.integer(f.lang.image.validateBorder),setup:function(E,D){if(E==e){var F,C=D.getStyle("border-width");C=C&&C.match(/^(\d+px)(?: \1 \1 \1)?$/);F=C&&parseInt(C[1],10);isNaN(parseInt(F,10))&&(F=D.getAttribute("border"));this.setValue(F)}},commit:function(E,D,C){var F=parseInt(this.getValue(),10);if(E==e||E==n){if(!isNaN(F)){D.setStyle("border-width",CKEDITOR.tools.cssLength(F));D.setStyle("border-style","solid")}else{if(!F&&this.isChanged()){D.removeStyle("border-width");D.removeStyle("border-style");D.removeStyle("border-color")}}if(!C&&E==e){D.removeAttribute("border")}}else{if(E==B){D.removeAttribute("border");D.removeStyle("border-width");D.removeStyle("border-style");D.removeStyle("border-color")}}}},{type:"text",id:"txtHSpace",width:"60px",label:f.lang.image.hSpace,"default":"",onKeyUp:function(){s(this.getDialog())},onChange:function(){z.call(this,"advanced:txtdlgGenStyle")},validate:CKEDITOR.dialog.validate.integer(f.lang.image.validateHSpace),setup:function(E,D){if(E==e){var G,F,I,C=D.getStyle("margin-left"),H=D.getStyle("margin-right");C=C&&C.match(l);H=H&&H.match(l);F=parseInt(C,10);I=parseInt(H,10);G=(F==I)&&F;isNaN(parseInt(G,10))&&(G=D.getAttribute("hspace"));this.setValue(G)}},commit:function(E,D,C){var F=parseInt(this.getValue(),10);if(E==e||E==n){if(!isNaN(F)){D.setStyle("margin-left",CKEDITOR.tools.cssLength(F));D.setStyle("margin-right",CKEDITOR.tools.cssLength(F))}else{if(!F&&this.isChanged()){D.removeStyle("margin-left");D.removeStyle("margin-right")}}if(!C&&E==e){D.removeAttribute("hspace")}}else{if(E==B){D.removeAttribute("hspace");D.removeStyle("margin-left");D.removeStyle("margin-right")}}}},{type:"text",id:"txtVSpace",width:"60px",label:f.lang.image.vSpace,"default":"",onKeyUp:function(){s(this.getDialog())},onChange:function(){z.call(this,"advanced:txtdlgGenStyle")},validate:CKEDITOR.dialog.validate.integer(f.lang.image.validateVSpace),setup:function(H,G){if(H==e){var I,C,E,D=G.getStyle("margin-top"),F=G.getStyle("margin-bottom");D=D&&D.match(l);F=F&&F.match(l);C=parseInt(D,10);E=parseInt(F,10);I=(C==E)&&C;isNaN(parseInt(I,10))&&(I=G.getAttribute("vspace"));this.setValue(I)}},commit:function(E,D,C){var F=parseInt(this.getValue(),10);if(E==e||E==n){if(!isNaN(F)){D.setStyle("margin-top",CKEDITOR.tools.cssLength(F));D.setStyle("margin-bottom",CKEDITOR.tools.cssLength(F))}else{if(!F&&this.isChanged()){D.removeStyle("margin-top");D.removeStyle("margin-bottom")}}if(!C&&E==e){D.removeAttribute("vspace")}}else{if(E==B){D.removeAttribute("vspace");D.removeStyle("margin-top");D.removeStyle("margin-bottom")}}}},{id:"cmbAlign",type:"select",widths:["35%","65%"],style:"width:90px",label:f.lang.common.align,"default":"",items:[[f.lang.common.notSet,""],[f.lang.common.alignLeft,"left"],[f.lang.common.alignRight,"right"]],onChange:function(){s(this.getDialog());z.call(this,"advanced:txtdlgGenStyle")},setup:function(D,C){if(D==e){var E=C.getStyle("float");switch(E){case"inherit":case"none":E=""}!E&&(E=(C.getAttribute("align")||"").toLowerCase());this.setValue(E)}},commit:function(E,D,C){var F=this.getValue();if(E==e||E==n){if(F){D.setStyle("float",F)}else{D.removeStyle("float")}if(!C&&E==e){F=(D.getAttribute("align")||"").toLowerCase();switch(F){case"left":case"right":D.removeAttribute("align")}}}else{if(E==B){D.removeStyle("float")}}}}]}]},{type:"vbox",height:"250px",children:[{type:"html",id:"htmlPreview",style:"width:95%;",html:"<div>"+CKEDITOR.tools.htmlEncode(f.lang.common.preview)+'<br><div id="'+t+'" class="ImagePreviewLoader" style="display:none"><div class="loading">&nbsp;</div></div><div id="'+b+'" class="ImagePreviewBox"><table><tr><td><a href="javascript:void(0)" target="_blank" onclick="return false;" id="'+d+'"><img id="'+g+'" alt="" /></a>'+(f.config.image_previewText||"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Maecenas feugiat consequat diam. Maecenas metus. Vivamus diam purus, cursus a, commodo non, facilisis vitae, nulla. Aenean dictum lacinia tortor. Nunc iaculis, nibh non iaculis aliquam, orci felis euismod neque, sed ornare massa mauris sed velit. Nulla pretium mi et risus. Fusce mi pede, tempor id, cursus ac, ullamcorper nec, enim. Sed tortor. Curabitur molestie. Duis velit augue, condimentum at, ultrices a, luctus ut, orci. Donec pellentesque egestas eros. Integer cursus, augue in cursus faucibus, eros pede bibendum sem, in tempus tellus justo quis ligula. Etiam eget tortor. Vestibulum rutrum, est ut placerat elementum, lectus nisl aliquam velit, tempor aliquam eros nunc nonummy metus. In eros metus, gravida a, gravida sed, lobortis id, turpis. Ut ultrices, ipsum at venenatis fringilla, sem nulla lacinia tellus, eget aliquet turpis mauris non enim. Nam turpis. Suspendisse lacinia. Curabitur ac tortor ut ipsum egestas elementum. Nunc imperdiet gravida mauris.")+"</td></tr></table></div></div>"}]}]}]},{id:"Link",label:f.lang.link.title,padding:0,elements:[{id:"txtUrl",type:"text",label:f.lang.common.url,style:"width: 100%","default":"",setup:function(E,D){if(E==m){var C=D.data("cke-saved-href");if(!C){C=D.getAttribute("href")}this.setValue(C)}},commit:function(E,D){if(E==m){if(this.getValue()||this.isChanged()){var C=decodeURI(this.getValue());D.data("cke-saved-href",C);D.setAttribute("href",C);if(this.getValue()||!f.config.image_removeLinkByEmptyURL){this.getDialog().addLink=true}}}}},{type:"button",id:"browse",filebrowser:{action:"Browse",target:"Link:txtUrl",url:f.config.filebrowserImageBrowseLinkUrl},style:"float:right",hidden:true,label:f.lang.common.browseServer},{id:"cmbTarget",type:"select",label:f.lang.common.target,"default":"",items:[[f.lang.common.notSet,""],[f.lang.common.targetNew,"_blank"],[f.lang.common.targetTop,"_top"],[f.lang.common.targetSelf,"_self"],[f.lang.common.targetParent,"_parent"]],setup:function(D,C){if(D==m){this.setValue(C.getAttribute("target")||"")}},commit:function(D,C){if(D==m){if(this.getValue()||this.isChanged()){C.setAttribute("target",this.getValue())}}}}]},{id:"Upload",hidden:true,filebrowser:"uploadButton",label:f.lang.image.upload,elements:[{type:"file",id:"upload",label:f.lang.image.btnUpload,style:"height:40px",size:38},{type:"fileButton",id:"uploadButton",filebrowser:"info:txtUrl",label:f.lang.image.btnUpload,"for":["Upload","upload"]}]},{id:"advanced",label:f.lang.common.advancedTab,elements:[{type:"hbox",widths:["50%","25%","25%"],children:[{type:"text",id:"linkId",label:f.lang.common.id,setup:function(D,C){if(D==e){this.setValue(C.getAttribute("id"))}},commit:function(D,C){if(D==e){if(this.getValue()||this.isChanged()){C.setAttribute("id",this.getValue())}}}},{id:"cmbLangDir",type:"select",style:"width : 100px;",label:f.lang.common.langDir,"default":"",items:[[f.lang.common.notSet,""],[f.lang.common.langDirLtr,"ltr"],[f.lang.common.langDirRtl,"rtl"]],setup:function(D,C){if(D==e){this.setValue(C.getAttribute("dir"))}},commit:function(D,C){if(D==e){if(this.getValue()||this.isChanged()){C.setAttribute("dir",this.getValue())}}}},{type:"text",id:"txtLangCode",label:f.lang.common.langCode,"default":"",setup:function(D,C){if(D==e){this.setValue(C.getAttribute("lang"))}},commit:function(D,C){if(D==e){if(this.getValue()||this.isChanged()){C.setAttribute("lang",this.getValue())}}}}]},{type:"text",id:"txtGenLongDescr",label:f.lang.common.longDescr,setup:function(D,C){if(D==e){this.setValue(C.getAttribute("longDesc"))}},commit:function(D,C){if(D==e){if(this.getValue()||this.isChanged()){C.setAttribute("longDesc",this.getValue())}}}},{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"txtGenClass",label:f.lang.common.cssClass,"default":"",setup:function(D,C){if(D==e){this.setValue(C.getAttribute("class"))}},commit:function(D,C){if(D==e){if(this.getValue()||this.isChanged()){C.setAttribute("class",this.getValue())}}}},{type:"text",id:"txtGenTitle",label:f.lang.common.advisoryTitle,"default":"",onChange:function(){s(this.getDialog())},setup:function(D,C){if(D==e){this.setValue(C.getAttribute("title"))}},commit:function(D,C){if(D==e){if(this.getValue()||this.isChanged()){C.setAttribute("title",this.getValue())}}else{if(D==n){C.setAttribute("title",this.getValue())}else{if(D==B){C.removeAttribute("title")}}}}}]},{type:"text",id:"txtdlgGenStyle",label:f.lang.common.cssStyle,"default":"",setup:function(G,E){if(G==e){var H=E.getAttribute("style");if(!H&&E.$.style.cssText){H=E.$.style.cssText}this.setValue(H);var C=E.$.style.height,F=E.$.style.width,I=(C?C:"").match(q),D=(F?F:"").match(q);this.attributesInStyle={height:!!I,width:!!D}}},onChange:function(){z.call(this,["info:cmbFloat","info:cmbAlign","info:txtVSpace","info:txtHSpace","info:txtBorder","info:txtWidth","info:txtHeight"]);s(this)},commit:function(D,C){if(D==e&&(this.getValue()||this.isChanged())){C.setAttribute("style",this.getValue())}}}]}]}};CKEDITOR.dialog.add("image",function(b){return a(b,"image")});CKEDITOR.dialog.add("imagebutton",function(b){return a(b,"imagebutton")})})();