CKEDITOR.plugins.add("listblock",{requires:["panel"],onLoad:function(){CKEDITOR.ui.panel.prototype.addListBlock=function(a,b){return this.addBlock(a,new CKEDITOR.ui.listBlock(this.getHolderElement(),b))};CKEDITOR.ui.listBlock=CKEDITOR.tools.createClass({base:CKEDITOR.ui.panel.block,$:function(a,c){c=c||{};var d=c.attributes||(c.attributes={});(this.multiSelect=!!c.multiSelect)&&(d["aria-multiselectable"]=true);!d.role&&(d.role="listbox");this.base.apply(this,arguments);var b=this.keys;b[40]="next";b[9]="next";b[38]="prev";b[CKEDITOR.SHIFT+9]="prev";b[32]="click";this._.pendingHtml=[];this._.items={};this._.groups={}},_:{close:function(){if(this._.started){this._.pendingHtml.push("</ul>");delete this._.started}},getClick:function(){if(!this._.click){this._.click=CKEDITOR.tools.addFunction(function(b){var a=true;if(this.multiSelect){a=this.toggle(b)}else{this.mark(b)}if(this.onClick){this.onClick(b,a)}},this)}return this._.click}},proto:{add:function(c,a,d){var b=this._.pendingHtml,e=CKEDITOR.tools.getNextId();if(!this._.started){b.push('<ul role="presentation" class=cke_panel_list>');this._.started=1;this._.size=this._.size||0}this._.items[c]=e;b.push("<li id=",e,' class=cke_panel_listItem role=presentation><a id="',e,'_option" _cke_focus=1 hidefocus=true title="',d||c,'" href="javascript:void(\'',c,'\')" onclick="CKEDITOR.tools.callFunction(',this._.getClick(),",'",c,"'); return false;\"",' role="option" aria-posinset="'+ ++this._.size+'">',a||c,"</a></li>")},startGroup:function(a){this._.close();var b=CKEDITOR.tools.getNextId();this._.groups[a]=b;this._.pendingHtml.push('<h1 role="presentation" id=',b," class=cke_panel_grouptitle>",a,"</h1>")},commit:function(){this._.close();this.element.appendHtml(this._.pendingHtml.join(""));var a=this._.items,c=this.element.getDocument();for(var b in a){c.getById(a[b]+"_option").setAttribute("aria-setsize",this._.size)}delete this._.size;this._.pendingHtml=[]},toggle:function(b){var a=this.isMarked(b);if(a){this.unmark(b)}else{this.mark(b)}return !a},hideGroup:function(a){var c=this.element.getDocument().getById(this._.groups[a]),b=c&&c.getNext();if(c){c.setStyle("display","none");if(b&&b.getName()=="ul"){b.setStyle("display","none")}}},hideItem:function(a){this.element.getDocument().getById(this._.items[a]).setStyle("display","none")},showAll:function(){var b=this._.items,a=this._.groups,f=this.element.getDocument();for(var d in b){f.getById(b[d]).setStyle("display","")}for(var g in a){var e=f.getById(a[g]),c=e.getNext();e.setStyle("display","");if(c&&c.getName()=="ul"){c.setStyle("display","")}}},mark:function(b){if(!this.multiSelect){this.unmarkAll()}var c=this._.items[b],a=this.element.getDocument().getById(c);a.addClass("cke_selected");this.element.getDocument().getById(c+"_option").setAttribute("aria-selected",true);this.element.setAttribute("aria-activedescendant",c+"_option");this.onMark&&this.onMark(a)},unmark:function(a){this.element.getDocument().getById(this._.items[a]).removeClass("cke_selected");this.onUnmark&&this.onUnmark(this._.items[a])},unmarkAll:function(){var a=this._.items,c=this.element.getDocument();for(var b in a){c.getById(a[b]).removeClass("cke_selected")}this.onUnmark&&this.onUnmark()},isMarked:function(a){return this.element.getDocument().getById(this._.items[a]).hasClass("cke_selected")},focus:function(e){this._.focusIndex=-1;if(e){var c=this.element.getDocument().getById(this._.items[e]).getFirst();var a=this.element.getElementsByTag("a"),d,b=-1;while((d=a.getItem(++b))){if(d.equals(c)){this._.focusIndex=b;break}}setTimeout(function(){c.focus()},0)}}}})}});