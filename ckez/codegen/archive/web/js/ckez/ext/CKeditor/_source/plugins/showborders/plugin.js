(function(){var a="cke_show_border",b,d=(CKEDITOR.env.ie6Compat?[".%1 table.%2,",".%1 table.%2 td, .%1 table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:[".%1 table.%2,",".%1 table.%2 > tr > td, .%1 table.%2 > tr > th,",".%1 table.%2 > tbody > tr > td, .%1 table.%2 > tbody > tr > th,",".%1 table.%2 > thead > tr > td, .%1 table.%2 > thead > tr > th,",".%1 table.%2 > tfoot > tr > td, .%1 table.%2 > tfoot > tr > th","{","border : #d3d3d3 1px dotted","}"]).join("");b=d.replace(/%2/g,a).replace(/%1/g,"cke_show_borders ");var c={preserveState:true,editorFocus:false,readOnly:1,exec:function(e){this.toggleState();this.refresh(e)},refresh:function(e){if(e.document){var f=(this.state==CKEDITOR.TRISTATE_ON)?"addClass":"removeClass";e.document.getBody()[f]("cke_show_borders")}}};CKEDITOR.plugins.add("showborders",{requires:["wysiwygarea"],modes:{wysiwyg:1},init:function(e){var f=e.addCommand("showborders",c);f.canUndo=false;if(e.config.startupShowBorders!==false){f.setState(CKEDITOR.TRISTATE_ON)}e.addCss(b);e.on("mode",function(){if(f.state!=CKEDITOR.TRISTATE_DISABLED){f.refresh(e)}},null,null,100);e.on("contentDom",function(){if(f.state!=CKEDITOR.TRISTATE_DISABLED){f.refresh(e)}});e.on("removeFormatCleanup",function(g){var h=g.data;if(e.getCommand("showborders").state==CKEDITOR.TRISTATE_ON&&h.is("table")&&(!h.hasAttribute("border")||parseInt(h.getAttribute("border"),10)<=0)){h.addClass(a)}})},afterInit:function(f){var e=f.dataProcessor,g=e&&e.dataFilter,h=e&&e.htmlFilter;if(g){g.addRules({elements:{table:function(l){var j=l.attributes,i=j["class"],k=parseInt(j.border,10);if(!k||k<=0){j["class"]=(i||"")+" "+a}}}})}if(h){h.addRules({elements:{table:function(k){var j=k.attributes,i=j["class"];i&&(j["class"]=i.replace(a,"").replace(/\s{2}/," ").replace(/^\s+|\s+$/,""))}}})}}});CKEDITOR.on("dialogDefinition",function(h){var i=h.data.name;if(i=="table"||i=="tableProperties"){var l=h.data.definition,g=l.getContents("info"),f=g.get("txtBorder"),e=f.commit;f.commit=CKEDITOR.tools.override(e,function(m){return function(p,n){m.apply(this,arguments);var o=parseInt(this.getValue(),10);n[(!o||o<=0)?"addClass":"removeClass"](a)}});var k=l.getContents("advanced"),j=k&&k.get("advCSSClasses");if(j){j.setup=CKEDITOR.tools.override(j.setup,function(m){return function(){m.apply(this,arguments);this.setValue(this.getValue().replace(/cke_show_border/,""))}});j.commit=CKEDITOR.tools.override(j.commit,function(m){return function(o,n){m.apply(this,arguments);if(!parseInt(n.getAttribute("border"),10)){n.addClass("cke_show_border")}}})}}})})();